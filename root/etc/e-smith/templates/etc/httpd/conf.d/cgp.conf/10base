{
    use esmith::ConfigDB;
    use esmith::util;
    my $confdb = esmith::ConfigDB->open;
    my $alias = $cgp{'alias'} || "";

    # initialize alias if needed
    if ($alias eq "") {
        $alias = esmith::util::genRandomHash();
        $confdb->set_prop('cgp','alias',$alias);
    }

    my $allowHosts = ${'httpd-admin'}{'AllowHosts'} || '';
    if ($allowHosts ne '') {
       # Convert from comma separated list to space separated
       $allowHosts =~ s/,/ /g;
       # Make sure that /32 ValidFrom specs don't cause Apache problems.
       $allowHosts =~ s:/255.255.255.255::g;
    }

    $OUT = "
Alias /$alias /usr/share/cgp

<Directory /usr/share/cgp>
    DirectoryIndex index.php
    AllowOverride None
    Order deny,allow
    Deny from all
    Allow from localhost $allowHosts
</Directory>
";
}
